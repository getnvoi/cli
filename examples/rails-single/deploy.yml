application:
  name: rails-single
  environment: production

  domain_provider:
    cloudflare:
      api_token: $CLOUDFLARE_API_TOKEN
      account_id: $CLOUDFLARE_ACCOUNT_ID

  compute_provider:
    hetzner:
      api_token: $HETZNER_API_TOKEN
      server_type: cx22
      server_location: fsn1
      architecture: x86

  servers:
    master:
      type: cx22
      location: fsn1

  keep_count: 2

  app:
    web:
      servers: [master]
      domain: rb.run
      subdomain: rails-single
      port: 80
      healthcheck:
        type: http
        path: /up
        port: 80
      env:
        RAILS_ENV: production
        RAILS_LOG_TO_STDOUT: "true"
        RAILS_SERVE_STATIC_FILES: "true"

    worker:
      servers: [master]
      command: bundle exec bin/jobs
      env:
        RAILS_ENV: production
        RAILS_LOG_TO_STDOUT: "true"

  database:
    servers: [master]
    adapter: postgres
    image: postgres:16-alpine
    volume: postgres_data
    secrets:
      POSTGRES_DB: rails_single_production
      POSTGRES_USER: rails_single
      POSTGRES_PASSWORD: $DB_PASSWORD

  env:
    SECRET_KEY_BASE: $SECRET_KEY_BASE
    RAILS_MASTER_KEY: $RAILS_MASTER_KEY
